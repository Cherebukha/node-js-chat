<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>NodeJS Chat</title>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }
		*:focus { outline: 0; }
		body, input, button { font: 14px Tahoma; background: repeating-linear-gradient(45deg, #eee, #eee 10px, #ddd 10px, #ddd 20px) }
		#main { display: flex; align-items: center; width: 100vw; height: 100vh; }
		#chat { display: flex; flex-direction: column; justify-content: space-between; width: 700px; height: 500px; margin: 0 auto; }
		#chatContainer { overflow: auto; }
		#overlay { display: flex; align-items: center; position: absolute; top: 0; z-index: 10; width: 100vw; height: 100vh; background: rgba(255, 255, 255, 0.8); }
		#nicknameContainer { display: flex; align-items: center; width: 230px; height: 40px; margin: 0 auto; background: #666; border-radius: 20px; }
		#nickname { margin: 0 auto; }
		#nickname input { width: 170px; height: 30px; border: 0; padding: 5px; padding-left: 10px; background: #fff; border-radius:  15px 0 0 15px; }
		#nickname button { width: 50px; height: 30px; border: none; padding: 5px; padding-right: 10px; border-radius: 0 15px 15px 0; }
		#message { height: 40px; background: #666; padding: 5px; width: 100%; }
		#message input { width: calc(100% - 70px); height: 30px; border: 0; padding: 5px; padding-left: 10px; background: #fff; border-radius: 15px 0 0 15px; }
		#message button { width: 70px; height: 30px; border: none; padding: 5px; padding-right: 10px; border-radius: 0 15px 15px 0; }
		button { background: rgb(230, 230, 230); }
		button:hover { background: rgb(190, 190, 190); }
		#messages, #userList { list-style-type: none; margin: 0; padding: 0 }
		#messages li { padding: 5px 10px; word-wrap: break-word; }
		#messages li:hover { background: #eee; }
		#userListContainer { position: absolute; top: 0; right: 0; width: 150px; min-height: calc(1em + 10px); padding: 5px; }
		.system { font-weight: bold; }
		.container { background: #fff; box-shadow: 0 0 3px 3px rgba(0, 0, 0, 0.2); transition: 0.5s; }
		.container:hover { box-shadow: 0 0 3px 3px rgba(0, 0, 0, 0.5); z-index: 15; }
	</style>
	<link rel="stylesheet" href="style/style.css" type="text/css">
	<script src="/socket.io/socket.io.js"></script>
	<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<body>
	<div id="main">
		<div id="chat" class="container">
			<div id="chatContainer">
				<ul id="messages"></ul>
			</div>
			<form id="message" action="">
				<input id="messageInput" autocomplete="off" type="text" /><button>Send</button>
			</form>
		</div>
		<div id="userListContainer" class="container">
			<h4>Users:</h4>
			<ul id="userList"></ul>
		</div>
	</div>
	<div id="overlay">
		<div id="nicknameContainer" class="container">
			<form id="nickname" action="">
				<input id="nicknameInput" autocomplete="off" type="text" maxlength="14" placeholder="Your nickname" autofocus /><button>Enter</button>
			</form>
		</div>
	</div>
	<script>
		var socket = io();
		socket.on('update user list', function(userList) {
			$('#userList').empty();
			userList.sort();
			for (var i = 0; i < userList.length; i++) {
				$('#userList').append($('<li>').text(userList[i]));
			}
		});
		$('#nickname').submit(function() {
			if ($('#nickname input').val() == "") return false;
			socket.emit('set nickname', $('#nicknameInput').val(), $('#p').val());
			$('#overlay').fadeOut(300);
			$('#nickname input').val('');
			document.getElementById('messageInput').focus();
			return false;
		});
		$('#message').submit(function() {
			if ($('messageInput').val() == "") return false;
			console.log($('messageInput').val());
			socket.emit('send message', $('#messageInput').val());
			$('#messageInput').val('');
			return false;
		});
		socket.on('join', function(status, name) {
			$('#messages').append($('<li class="system">').text('User ' + status + ': ' + name));
		});
		socket.on('send message', function(name, msg) {
			$('#messages').append($('<li>').text(name + ': ' + msg));
			$('#chatContainer').animate({ scrollTop: $('#chatContainer').height() }, 'fast');
		});
	</script>
</body>
</html>